# Deploy an Onchain App with Fleek

Fleek is an edge-optimized cloud platform that enables developers to build and deploy applications with exceptional performance. Powered by Fleek Network, a decentralized content delivery network, Fleek combines the speed and reliability of traditional CDNs with the benefits of Web3 infrastructure including IPFS content addressing, decentralized storage (Filecoin/Arweave), and blockchain-native features.

This tutorial guides you through deploying an onchain application using Fleek's modern hosting platform with automated CI/CD, enabling you to ship faster while maintaining full control over your infrastructure.

---

## Objectives

By the end of this tutorial, you'll be able to:

- Deploy a Next.js application using Coinbase Smart Wallet on Fleek
- Set up automated deployments with GitHub integration
- Configure custom domains and ENS names for your application
- Leverage Fleek Network's edge infrastructure for optimal performance

---

## Prerequisites

### Next.js Knowledge

You should have basic familiarity with Next.js. Experience with other React frameworks will be helpful, as the patterns are similar.

### Onchain App Development

This tutorial assumes you understand the fundamentals of building onchain applications and connecting them to smart contracts. If you're new to this, start with the [Building an Onchain App] tutorials in [Base Learn].

### Required Tools

- **Node.js** (v18 or later recommended)
- **Git** and a GitHub account
- **Bun** or npm for package management

---

## Project Setup

### Using the Onchain App Template

Skip this section if you already have an app built from the template, such as from the [How to Mint on Zora with an App] tutorial.

**Create your project:**

1. Visit the [Onchain App Template] repository
2. Click the green **Use this template** button
3. Create a new repository from the template
4. Clone your repository locally

**Install dependencies:**

```bash
# Install bun if needed
curl -fsSL https://bun.sh/install | bash

# Install project dependencies
bun install

# Start the development server
bun run dev
```

**Verify setup:**

Navigate to `http://localhost:3000` and confirm the application runs correctly. You can then stop the development server.

**Note:** For this tutorial, you don't need to configure environment variables.

---

## Configuring for Fleek Deployment

Fleek requires static site generation for optimal performance on its edge network. Configure your Next.js application accordingly.

### Update Next.js Configuration

Open `next.config.js` and update the configuration:

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',
  reactStrictMode: true,
  images: {
    unoptimized: true,
  },
  trailingSlash: true,
};

module.exports = nextConfig;
```

**Configuration explained:**
- `output: 'export'` - Generates static HTML files
- `images: { unoptimized: true }` - Disables Next.js image optimization (required for static export)
- `trailingSlash: true` - Ensures consistent URL patterns

**Test the build:**

```bash
bun run build
```

Verify that an `out` directory is created with your static files.

---

## Setting Up Fleek

### Create Your Account

1. Navigate to [Fleek.xyz](https://fleek.xyz)
2. Sign up for a free account or log in if you already have one
3. You'll be directed to your dashboard with a default project

### Install Fleek CLI

The Fleek CLI enables deployment management from your terminal:

```bash
npm install -g @fleek-platform/cli
```

**Verify installation:**

```bash
fleek -v
```

You should see a version number (2.10.1 or higher is recommended).

---

## Connecting Your Repository

### Link GitHub to Fleek

1. In your Fleek dashboard, click **Add New** (upper right)
2. Select **Deploy My Site**
3. Choose **GitHub** as your code location
4. Authorize Fleek to access your repositories
5. Grant permissions (all repos or specific repositories)

### Configure Your Site

After selecting your repository:

1. **Site Name**: Choose a descriptive name for your site
2. **Framework**: Fleek auto-detects Next.js
3. **Branch**: Select `main` (or your production branch)
4. **Publish Directory**: `out`
5. **Build Command**: `npm install && npm run build`

Click **Deploy Site** to start the initial deployment.

**Expected behavior:** Your first deployment may fail - this is normal and will be resolved in the next steps.

---

## CLI Configuration

### Authenticate with Fleek

From your project's root directory:

```bash
fleek login
```

A browser window will open. Click **Confirm** to authenticate, then **Visit Dashboard** when prompted.

### Initialize Your Site

Run the initialization command:

```bash
fleek sites init
```

**Follow the prompts:**

1. **Select project**: Choose your project (likely "First Project")
2. **Link existing site**: Select `Y` (Yes)
3. **Choose your site**: Select the site you created earlier
4. **Configuration format**: Select `JSON (fleek.config.json)` 
   - ⚠️ **Important:** Do NOT select TypeScript format, even though you're using TypeScript

**Configuration details:**

```
? Directory for site files: out
? Include build command?: Y
? Build command: npm install && npm run build
? Configuration format: JSON (fleek.config.json)
```

A `fleek.config.json` file will be created in your project root.

---

## Automated Deployment

### Enable CI/CD with Git

Fleek automatically deploys when you push to your repository - no manual CLI deployment needed.

**Trigger your first automated deployment:**

1. Make a small change to your code (e.g., update text in `src/app/page.tsx`)
2. Commit your changes:
   ```bash
   git add .
   git commit -m "Configure Fleek deployment"
   git push origin main
   ```

3. Fleek will automatically detect the push and trigger a deployment

### Monitor Deployment

**View deployment progress:**

1. Open your Fleek dashboard
2. Navigate to **Sites** → Select your site
3. Click the **Deploys** tab
4. Watch your deployment status change from **Pending** to **Live**

**Access your deployed site:**

Once deployment completes, click on the build to view deployment details and access your live site URL (e.g., `https://your-site-name.on-fleek.app`).

---

## Dashboard Features

### Site Overview

Your site dashboard provides comprehensive deployment management:

- **Overview**: Quick stats and site status
- **Deploys**: Full deployment history with logs
- **Settings**: Domain configuration, build settings, and more
- **Analytics**: (if enabled) Traffic and performance metrics

### Deploy Previews

Fleek automatically creates preview deployments for pull requests:

1. Enable in **Settings** → **Build & Deploy** → **Deploy Contexts**
2. Open a pull request to your production branch
3. View the preview deployment directly in your GitHub PR
4. Test changes before merging to production

### Custom Domains

**Configure a custom domain:**

1. Navigate to **Settings** → **Domains**
2. Click **Add Domain**
3. Enter your domain name
4. Configure your DNS provider with the provided records
5. Fleek will automatically provision SSL certificates

**Configure an ENS domain:**

1. Navigate to **Settings** → **Domains**
2. Select **ENS Domain**
3. Follow the prompts to link your ENS name
4. Your site will be accessible via your ENS domain

### Build Settings

Customize your deployment pipeline:

- **Environment Variables**: Add secrets and configuration
- **Build Commands**: Modify build and install commands
- **Node Version**: Specify Node.js version
- **Deploy Notifications**: Configure webhook or email alerts

---

## Advanced Features

### Fleek Network Integration

Fleek is progressively integrating Fleek Network features:

- **Decentralized CDN**: Content delivery via Fleek Network nodes
- **IPFS Addressing**: Automatic content addressing and pinning
- **Decentralized Storage**: Optional Filecoin/Arweave integration
- **Edge Functions**: Server-side code execution at the edge

### Performance Optimization

Fleek automatically optimizes your deployment:

- **Global Edge Network**: Content served from locations closest to users
- **Smart Caching**: Intelligent cache management for static assets
- **Compression**: Automatic brotli/gzip compression
- **HTTP/3 Support**: Latest protocol support for faster connections

---

## Troubleshooting

### Common Issues

**Build fails with "output directory not found":**
- Verify `next.config.js` includes `output: 'export'`
- Check that build command produces an `out` directory
- Review build logs in Fleek dashboard for specific errors

**Images not displaying:**
- Ensure `images: { unoptimized: true }` is in your config
- Use standard `<img>` tags instead of Next.js `<Image>` component for static export
- Or use `next/image` with proper loader configuration

**Deployment doesn't trigger on push:**
- Verify GitHub integration in Fleek dashboard
- Check that you're pushing to the configured branch
- Ensure the Fleek GitHub app has proper repository permissions

**Site shows old content after deployment:**
- Clear your browser cache
- Wait a few minutes for CDN propagation
- Use deploy preview feature to verify changes

---

## Production Checklist

Before going live with your application:

- [ ] Test the site thoroughly using deploy previews
- [ ] Configure environment variables for production
- [ ] Set up custom domain or ENS name
- [ ] Enable deploy previews for safer updates
- [ ] Review build settings and optimize build time
- [ ] Set up deployment notifications
- [ ] Test on multiple devices and browsers
- [ ] Verify wallet connection works correctly
- [ ] Check that all smart contract interactions function properly
- [ ] Monitor first deployment for any edge cases

---

## What's Next

Now that your app is deployed on Fleek:

- **Explore Fleek Functions**: Add server-side functionality with edge functions
- **Implement Full-Stack Next.js**: Use Fleek's SSR support for dynamic content
- **Integrate ENS**: Give your app a memorable blockchain-native domain
- **Monitor Performance**: Use Fleek analytics to track usage
- **Scale Up**: Leverage Fleek Network's decentralized infrastructure as you grow

---

## Resources

- [Fleek Documentation](https://hosting.fleek.xyz/docs/)
- [Fleek CLI Reference](https://hosting.fleek.xyz/docs/cli/)
- [Fleek Network](https://fleek.network/)
- [Fleek Discord Community](https://discord.gg/fleek)
- [Fleek Templates](https://fleek.xyz/templates/)
- [GitHub Issues](https://github.com/fleek-platform)

---

## Conclusion

In this tutorial, you learned how to deploy a Next.js onchain application using Fleek's edge-optimized hosting platform. You configured automated deployments with GitHub integration, explored Fleek's dashboard features, and learned about the decentralized infrastructure powering your application.

Fleek combines the developer experience of modern deployment platforms with the benefits of Web3 infrastructure, giving you the tools to build fast, reliable, and truly decentralized applications.

---

[Base Learn]: https://base.org/learn
[Smart Wallet]: https://www.smartwallet.dev/why
[Next.js]: https://nextjs.org/
[Onchain App Template]: https://github.com/coinbase/onchain-app-template
[How to Mint on Zora with an App]: https://docs.base.org/guides/nft-minting-with-zora
